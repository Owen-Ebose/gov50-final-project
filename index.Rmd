---
title: "Gov 50 Final Project"
author: "Owen Ebose"
description: "Owen's final project on the relationship between employment class and democratic participation."
output:
  distill::distill_article:
    self_contained: false
---

```{r, echo=FALSE}
library(tidyverse)
library(stringr)
library(dplyr)

#loading data and selecting variables

#census_raw <- read_csv("nov22pub (1).csv")
#census <- census_raw |>
  #select(employment_class=PEIO1COW, voted=PES1, income_code=HEFAMINC, education=PEEDUCA, state=GESTFIPS, sex=PESEX, race=PTDTRACE)
#write.csv(census,"census.csv")

census <- read_csv("census.csv")
```

```{r, echo=FALSE}

#preparing data
#replacing coded values and creating new variables 

census$employment_class <- census$employment_class |>
  case_match(1 ~ "Federal gov't",
             2 ~ "State gov't",
             3 ~ "Local gov't", 
             4 ~ "For-profit",
             5 ~ "Non-profit",
             6 ~ "Self-employed",
             7 ~ "Self-employed",
             .default = "other")
census <- census |>
  filter(employment_class != "other")

#creating binary employment type variable 
census <- census |>
  mutate(employment_type = case_when(
    employment_class == "Federal gov't" | employment_class == "State gov't" | employment_class == "Local gov't" | employment_class == "Non-profit" | employment_class == "Self-employed" ~ "Other",
    employment_class == "For-profit" ~ "For-profit"))

#numeric voted variable
census$voted_num <- census$voted |>
  case_match(1 ~ 1,
             2 ~ 0,
             .default= 2)
#character voted variable
census$voted <- census$voted |>
  case_match(1 ~ "Yes",
             2 ~ "No",
             .default = "other")
#filtering out others
census <- census |>
  filter(voted != "other")

#adjusting sex variable
census$sex <- census$sex |>
  case_match(1 ~ "male",
             2 ~ "female")

census$house_income <- census$income_code |>
  case_match(-1 ~ "other",
             1 ~ "less than 5",
             2 ~ "5 to 7.499",
             3 ~ "7.5 to 9.999", 
             4 ~ "10 to 12.499",
             5 ~ "12.5 to 14.999",
             6 ~ "15 to 19.999",
             7 ~ "20 to 24.999",
             8 ~ "25 to 29.999",
             9 ~ "30 to 34.999",
             10 ~ "35 to 39.999",
             11 ~ "40 to 49.999",
             12 ~ "50 to 59.999",
             13 ~ "60 to 74.999",
             14 ~ "75 to 99.999",
             15 ~ "100 to 149.999",
             16 ~ "150 or more")
census <- census |>
  filter(house_income != "other")

#broadening above household income categories
census <- census |>
  mutate(broad_income_categories = case_when(
    income_code >= 1 & income_code <= 5 ~ "Below 15,000",
    income_code >= 6 & income_code <= 9 ~ "15,000 to 34,999",
    income_code >= 10 & income_code <= 12 ~ "35,000 to 59,999",
    income_code >= 13 & income_code <= 14 ~ "60,000 to 99,999",
    income_code == 15 ~ "100,000 to 149,999",
    income_code == 16 ~ "150,000 or more"))

#creating numeric household income variable by taking average of upper/lower house_income bounds
census$house_income_num <- census$income_code |>
  case_match(1 ~ 2500,
             2 ~ 6250,
             3 ~ 8750, 
             4 ~ 11250,
             5 ~ 13750,
             6 ~ 17500,
             7 ~ 22500,
             8 ~ 27500,
             9 ~ 32500,
             10 ~ 37500,
             11 ~ 45000,
             12 ~ 55000,
             13 ~ 67500,
             14 ~ 87500,
             15 ~ 125000,
             16 ~ 150000)
census$education <- census$education |>
  case_match(31 ~ "less than 1st grade",
             32 ~ "1st-4th",
             33 ~ "5th or 6th", 
             34 ~ "7th or 8th",
             35 ~ "9th",
             36 ~ "10th",
             37 ~ "11th",
             38 ~ "12th no diploma",
             39 ~ "high school diploma",
             40 ~ "some college no degree",
             41 ~ "associate degree vocational",
             42 ~ "associate degree academic",
             43 ~ "bachelor's degree",
             44 ~ "master's degree",
             45 ~ "professional degree",
             46 ~ "doctorate degree")
education_levels <- c("less than 1st grade", "1st-4th", "5th or 6th", "7th or 8th", "9th", "10th", "11th", "12th no diploma", "high school diploma", "some college no degree", "associate degree vocational", "associate degree academic", "bachelor's degree", "master's degree", "professional degree", "doctorate degree")
census$education <- factor(census$education, levels = education_levels)

census <- census |>
  mutate(college_degree = case_when(
    education == "less than 1st grade" | education == "1st-4th" | education == "5th or 6th" | education == "7th or 8th" | education == "9th" | education == "10th" | education == "11th" | education == "12th no diploma" | education == "high school diploma" | education == "some college no degree" ~ 0,
    education == "associate degree vocational" | education == "associate degree academic" | education == "bachelor's degree" | education == "master's degree" | education == "professional degree" | education == "doctorate degree" ~ 1))

census$state <- as.character(census$state)
census$employment_class <- as.factor(census$employment_class)

census$race <- census$race |>
  case_match(1 ~ "White",
             2 ~ "Black",
             3 ~ "American Indian", 
             4 ~ "Asian",
             5 ~ "Hawaiian/Pacific Islander",
             .default = "Mixed")

```

# Section 1

Is one's ability or willingness to participate in democracy affected by where they work? This project examines the relationship between democratic participation and "employment class" as defined by the United States Census Bureau. The Bureau divides American workplaces into six classes: federal government, state government, local government, private for-profit, private non-profit, and self-employed. I hypothesize that those who are the most inclined to participate (1) work in settings where politics are involved or discussed, (2) have more control over their schedules, and/or (3) benefit from workplace autonomy. The first because proximity to politics can inspire or pressure one to participate. The second because greater control over one's schedule enables them to carve out time for political activities like rallies and voting. And the third because the democratic theory literature suggests a relationship between autonomy in the workplace---that is, the ability of workers to dialogue and collaborate with bosses to shape their work experience and the direction of the organization---and participation in the polity: autonomous workers develop useful decision making and information processing tools and a sense of agency that carry over from the workplace to the political realm. 

Thus, I expect to find that workers for the government, non-profits, and the self-employed participate the most, while workers for for-profits participate the least. Government workplaces are proximate to politics in the sense that their mandates and directives are directly determined through the political process. Their bosses are or are appointed by politicians. Their day-to-day work experiences are shaped by politics so they are likely invested in political decision making. Those who are self-employed set their own work hours and can therefore carve out the time needed for political activity such as voting. Non-profit workplaces are often small, meaning workers have more opportunities to directly interface with decision makers. For-profit workplaces are often large and hierarchical; average workers have little opportunity to shape the direction of the company and limited control over their schedules, and may or may not be close to the political process. 

Learning about the work conditions favorable to democratic participation can inform national- and state-level labor policies. Governments should want to encourage participation among citizens. 

# Section 2

Respondents to the Census Bureau's monthly Current Population Survey are asked to identify themselves as one of the six classes of workers and report their voting history, household income, education level, location, and more. The most recent survey asked 126,097 respondents whether or not they voted in the 2022 national elections. To test my hypothesis, I compare the 2022 turnout rates of each class, controlling for potential confounders such as income and education level. My hypothesis will be supported if I discover that workers at for-profits turned out a lower rate than workers for the other classes in 2022. I use voter turnout as a measure of democratic participation on the whole because voting is the most basic and accessible form of participation, meaning it should capture workers of all degrees of commitment: the least committed participants will vote, and the most committed participants will vote *and* engage in other democratic activities such as attending rallies.

The code that I used to prepare the data (import, wrangle, etc.) can be found at the bottom of the site. 

First, I calculate the proportions of each group in the survey sample. 

```{r}
census |>
  group_by(employment_class) |>
  summarize(Number = n()) |>
  mutate(`Proportion (%)` = Number / sum(Number) * 100) |>
  knitr::kable(digits = 2)
```
For-profit employees make up the vast majority of the sample (67%). This is consistent with the Bureau of Labor Statistics' projection that 71% of all U.S. workers work for for-profit firms. Thus, inferences about for-profit employees are relevant to a large portion of Americans. 

An initial plot of the dependent variable (2022 voter turnout) reveals that, indeed, turnout differs significantly across classes. In particular, government and non-profit employees and the self-employed turned out at a similar rate (above 70%), a rate much higher than that of for-profit employees (57%). 

```{r}
#calculating turnout rates by employment class
employment_class_turnout <- census |>
  group_by(employment_class) |>
  summarize(turnout = mean(voted_num) * 100)
knitr::kable(employment_class_turnout, digits = 2)

#plotting turnout rates by employment class
employment_class_turnout_plot <- employment_class_turnout |>
  ggplot(mapping = aes(x = fct_reorder(employment_class, turnout), y = turnout)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Employment Class and Democratic Participation",
    x = "Employment class",
    y = "Turnout (%) in 2022 national elections",
    caption = "Note: Employment Class categorizes workers according to the type of ownership of the employing organization. This variable identifies whether the respondent is self-employed, works in the private sector, or in government (U.S. Census Bureau). Self-employed not included."
  ) +
  theme_classic() +
  theme(plot.margin = margin(b = 10))
wrapped_caption <- str_wrap("Note: Employment Class categorizes workers according to the type of ownership of the employing organization. This variable identifies whether the respondent is self-employed, works in the private sector, or in government (U.S. Census Bureau). Self-employed not included.", width = 112)
employment_class_turnout_plot <- employment_class_turnout_plot + labs(caption = wrapped_caption)
employment_class_turnout_plot
```

# Section 3

An initial visualization of 2022 turnout rates suggests a different in rates across classes. To explore this relationship, I conduct a regression analysis of turnout rates on employment class, controlling for a number of potential confounders. 


```{r}
library(modelsummary)

census$employment_class <- relevel(census$employment_class, ref = "For-profit")

lm1 <- summary(lm(voted_num ~ employment_class + house_income_num + college_degree + state + sex + race, data = census))

lm2 <- summary(lm(voted_num ~ employment_class, data = census))

var_labels <- c(
  "employment_classFederal gov't"  = "Federal gov't",
  "employment_classLocal gov't" = "Local gov't",
  "employment_classNon-profit" = "Non-profit",
  "employment_classSelf-employed" = "Self-employed",
  "employment_classState gov't" = "State gov't",
  "house_income_num" = "Annual household income",
  "college_degree" = "College degree",
  "sex" = "Sex",
  "raceHawaiian/Pacific Islander" = "Race: Hawaiian/Pacific Islander",
  "raceWhite" = "Race: White",
  "raceBlack" = "Race: Black",
  "raceMixed" = "Race: Mixed",
  "raceAsian" = "Race: Asian")

modelsummary::modelsummary(list(lm1, lm2),
                           gof_map = c("nobs", 
                                       "r.squared", 
                                       "adj.r.squared"),
                           statistic = c("s.e. = {std.error}",
                                         "p = {p.value}"),
                           coef_map = var_labels,
                           note = "State covariate included in analysis but omitted from table",
                           stars = TRUE)

```
















# Exploratory data analysis

First, where do most Americans work? Which class is the largest? I calculate the proportions of each class in the sample.

```{r, echo=FALSE}
census |>
  group_by(employment_class) |>
  summarize(Number = n()) |>
  mutate(`Proportion (%)` = Number / sum(Number) * 100) |>
  knitr::kable(digits = 2)
```


I am first interested in gauging which group recorded a higher turnout rate in 2022. I will start by calculating turnout rates for each of the two employment type categories, then will break the nonprofit category down and calculate the rates for each of the five employment classes. I will visualize both sets of rates as barplots, and conclude by calculating the differences in turnout rates to estimate the effect of employment type on one's electoral participation. 

```{r, echo=FALSE}
#calculating turnout rates by employment type
employment_type_turnout <- census |>
  group_by(employment_type) |>
  summarize(turnout = mean(voted_num) * 100)
knitr::kable(employment_type_turnout, digits = 2)

#calculating turnout rates by employment class
employment_class_turnout <- census |>
  group_by(employment_class) |>
  summarize(turnout = mean(voted_num) * 100)
knitr::kable(employment_class_turnout, digits = 2)
```

```{r, echo=FALSE}
#plotting turnout rates by employment type
employment_type_turnout_plot <- employment_type_turnout |>
  ggplot(mapping = aes(x = employment_type, y = turnout)) +
  geom_col() +
  labs(
    title = "Relationship Between Employment Type and Democratic Participation",
    x = "Employment type",
    y = "Turnout (%) in 2022 national elections") +
  theme_classic()
employment_type_turnout_plot

#plotting turnout rates by employment class
employment_class_turnout_plot <- employment_class_turnout |>
  ggplot(mapping = aes(x = fct_reorder(employment_class, turnout), y = turnout)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Relationship Between Employment Class and Democratic Participation",
    x = "Employment class",
    y = "Turnout (%) in 2022 national elections",
    caption = "Note: Employment class categorizes workers according to the type of ownership of the employing organization. This variable identifies whether the respondent is self-employed, works in the private sector, or in government (U.S. Census Bureau). Self-employed not included."
  ) +
  theme_classic() +
  theme(plot.margin = margin(b = 10))
wrapped_caption <- str_wrap("Note: Employment class categorizes workers according to the type of ownership of the employing organization. This variable identifies whether the respondent is self-employed, works in the private sector, or in government (U.S. Census Bureau). Self-employed not included.", width = 112)
employment_class_turnout_plot <- employment_class_turnout_plot + labs(caption = wrapped_caption)
employment_class_turnout_plot
```

```{r, echo=FALSE}
diff_in_type_rates <- employment_type_turnout |>
  pivot_wider(names_from = employment_type,
              values_from = turnout) |>
  mutate(difference = Other - `For-profit`) |>
  select(difference)
knitr::kable(diff_in_type_rates, digits = 2)
```
Those who work at a non-company turned out at a rate 15.54% higher than those working at a company in 2022. Workers for the federal government, state government, local government, and nonprofits and the self-employed all turned out at rates higher than 70%, meanwhile workers at forprofit companies turned out at a rate of 57%. This suggests that there is something unique about working at a forprofit company that inhibits one's ability or willingness to participate in elections. Every other kind of worker participates much more. 

An important feature of one's employment is their wage or salary. Income could have something to do with the observed effect, especially if one group receives a higher income than the other. I first calculate and compare the average annual household incomes of the two types, those who work for a company and those who work for a non-company. 

```{r, echo=FALSE}
type_income_average <- census |>
  group_by(employment_type) |>
  summarize(`Average household income` = mean(house_income_num)) |>
  pivot_wider(names_from = employment_type,
              values_from = `Average household income`) |>
  mutate(difference = Other - `For-profit`)
knitr::kable(type_income_average, digits = 2)
```

Those who work at non-companies made on average $5727.33 more in 2022 than those who work at companies. It could be that making a higher income drives one's ability or willingness to participate in elections, since the same people who make the highest incomes are the ones who turnout to vote at the highest rates. To explore the relationship between income and turnout, I calculate and plot the turnout rates of each annual household income group in 2022. 

```{r, echo=FALSE}
income_group_turnout <- census |>
  group_by(broad_income_categories) |>
  summarize(turnout = mean(voted_num) * 100)
income_group_turnout <- arrange(income_group_turnout, desc(turnout))
knitr::kable(income_group_turnout, digits = 2)

income_group_turnout_plot <- income_group_turnout |>
  ggplot(mapping = aes(x = fct_reorder(broad_income_categories, turnout), y = turnout)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Relationship between annual household income and electoral participation",
    x = "Annual household income (in thousands of dollars)",
    y = "Turnout (%) in 2022 national nlections"
  ) +
  theme_classic()
income_group_turnout_plot
```

It seems as though income is related to turnout: the highest income groups turnout the most, and the lowest income groups turnout the least. 

In light of the likely relationship between income and turnout, I run a regression analysis to assess the relationship between employment type and turnout holding income constant. 

```{r, echo=FALSE}
library(modelsummary)

census$employment_class <- relevel(census$employment_class, ref = "For-profit")

lm1 <- summary(lm(voted_num ~ employment_class + house_income_num + college_degree + state + sex + race, data = census))

lm2 <- summary(lm(voted_num ~ employment_class, data = census))

var_labels <- c(
  "employment_classFederal gov't"  = "Federal gov't",
  "employment_classLocal gov't" = "Local gov't",
  "employment_classNon-profit" = "Non-profit",
  "employment_classSelf-employed" = "Self-employed",
  "employment_classState gov't" = "State gov't")
modelsummary::modelsummary(list(lm1, lm2),
                           gof_map = c("nobs", "r.squared", "adj.r.squared"),
                           coef_map = var_labels,
                           statistic = "std.error",
                           stars = TRUE,
                           notes = "Household income, college degree, state, sex, and race variables are factored into model 1 but are omitted from the table.")




```

I further illustrate the effect of employment type on turnout holding income constant by calculating and visualizing the turnout rates of each type within income groups. 

```{r, echo=FALSE}
#calculating turnout rates of employment types within income groups

type_income_turnout <- census |>
  group_by(broad_income_categories, employment_type) |>
  summarize(turnout = mean(voted_num) *100)

custom_levels <- c("150,000 or more","100,000 to 149,999","60,000 to 99,999", "35,000 to 59,999", "15,000 to 34,999", "Below 15,000")
type_income_turnout$broad_income_categories <- factor(type_income_turnout$broad_income_categories, levels = custom_levels)

type_income_turnout_plot <- type_income_turnout |>
  ggplot(aes(x = factor(turnout), y = turnout, fill = employment_type)) +
    geom_col() +
    facet_wrap(~broad_income_categories, ncol = 3, scales = "free_x", drop = TRUE) +
    theme(
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) +
  labs(title = "By annual household income group (in thousands of dollars)", x = NULL, y = "Turnout (%) in 2022 national elections")
type_income_turnout_plot

```

Within each income group, workers at non-companies turnout more than workers at companies.

# Code

```{r print-code, ref.label=knitr::all_labels(), echo = TRUE, eval=FALSE}

```

## Milestones

# Milestones 3 and 4



questions:

how do i explain p values produced by regression?
should I create confidence intervals based on difference in turnout?
when I'm calculating something like proportions of each class... should I run some sort of test to confirm those proportions? Can I go ahead and say that these are the proportions we are working with in the general U.S. population?


how should i display regression model output? is knitr kable function ok? Modelsummary? Stargazer?

non profits CAN BE COMPANIES!!!

update to include self-employed.

footnote: I combined self-employed classes



Later: talk about internal validity (survey method, randomization, social desirability bias)

the explanatory variable of interest is "class" of work as defined by the Census Bureau and the outcome variable of interest is whether or not the respondent voted (coded "1" for voted and "2" for not voted in the dataset)